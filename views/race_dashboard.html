<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Race Data</title>
</head>
<body id="race-dashboard">

<div class="timer-container dashboard-content">
    <div>
        <h2>Race Information</h2>
        <div id="race-info"></div>
        <!--        <p><strong>Name:</strong> John Doe</p>-->
        <!--        <p><strong>Loop (km):</strong> 12</p>-->
        <!--        <p><strong>Created At:</strong> 2025-04-03 20:01:20</p>-->
        <!--        <p><strong>Start Time:</strong> 11/02/2025, 22:29</p>-->
        <!--        <p><strong>Cutoff Time:</strong> 02:30</p>-->
    </div>
</div>
<script>
    if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", () => {
            // Edge case
            populateCurrentRace();
        });
    } else {
        console.log("DOM already loaded â€” run now");
        let raceInfo = document.getElementById('race-info');

        function newParagraph(title, subTitle){
            let paragraph = document.createElement('p');
            paragraph.className = 'race-detail';
            let strong = document.createElement('strong');
            strong.textContent = `${title}: `;
            //<p><strong>Loop (km):</strong> 12</p>
            paragraph.appendChild(strong);
            paragraph.appendChild(document.createTextNode(subTitle));
            raceInfo.appendChild(paragraph);
        }

        function populateCurrentRace(){
            fetch('/api/current-race', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            }).then((res) => res.json())
                .then((data) => {
                    if(data.error){
                        showToast("An error occur", "error");
                    }else{
                        if(data.length === 0){
                            const noRace = document.createElement('p');
                            noRace.textContent = "No race found.";
                            raceInfo.appendChild(noRace)
                            return;
                        }
                        newParagraph('Name', data.name);
                        newParagraph('Loop (km)', `${data.loop_km} km`);
                        newParagraph('Start Time', data.start_time);
                        newParagraph('Cutoff Time', data.cutoff_time);
                    }
                }).catch((err) => {
                console.log('User not logged inqq', 'error');
            });
        }
        populateCurrentRace();

    }

</script>
</body>
</html>
